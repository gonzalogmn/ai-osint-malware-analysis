from src.application.clean_input import CleanInput
from src.application.extract_reference_text_from_reference_urls import (
    ExtractReferenceTextFromReferenceURLs,
)
from src.application.fill_malware_type_from import FillMalwareTypeFrom
from src.application.predict_malware_type_with_nlp import PredictMalwareTypeWithNLP
from src.application.read_input import ReadInput
from src.infrastructure.mongodb_cve_repository import MongoDBCVERepository

if __name__ == "__main__":
    COLLECTION_SUFFIX = "_20240804"
    CVES_RAW_COLLECTION = "cvs_raw" + COLLECTION_SUFFIX
    CVES_CLEAN_COLLECTION = "cves_clean" + COLLECTION_SUFFIX
    CVES_IT1_COLLECTION = "cves_it1" + COLLECTION_SUFFIX
    CVES_IT2_COLLECTION = "cves_it2" + COLLECTION_SUFFIX
    CVES_IT3_COLLECTION = "cves_it3" + COLLECTION_SUFFIX

    cves_raw_repository = MongoDBCVERepository(collection_name=CVES_RAW_COLLECTION)
    cves_clean_repository = MongoDBCVERepository(collection_name=CVES_CLEAN_COLLECTION)
    cves_it1_repository = MongoDBCVERepository(collection_name=CVES_IT1_COLLECTION)
    cves_it2_repository = MongoDBCVERepository(collection_name=CVES_IT2_COLLECTION)
    cves_it3_repository = MongoDBCVERepository(collection_name=CVES_IT3_COLLECTION)

    read_input = ReadInput(cves_raw_repository)
    clean_input = CleanInput(cves_raw_repository, cves_clean_repository)
    extract_reference_text_from_reference_urls = ExtractReferenceTextFromReferenceURLs(
        cves_clean_repository, cves_clean_repository
    )
    fill_malware_type_from_description = FillMalwareTypeFrom(
        cves_clean_repository, cves_it1_repository, "description"
    )
    # fill_malware_type_from_reference_text = FillMalwareTypeFrom(
    #     cves_it1_repository, cves_it2_repository, "reference_text"
    # )
    predict_malware_type_with_nlp = PredictMalwareTypeWithNLP(
        cves_it1_repository, cves_it2_repository
    )

    # read_input()
    # clean_input()
    # extract_reference_text_from_reference_urls()
    # fill_malware_type_from_description()
    # fill_malware_type_from_reference_text()
    predict_malware_type_with_nlp()
